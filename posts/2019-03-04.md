# 2019년 2월 26일

## 로그 붙이기

스쿨 대시보드를 이용하는 사용자 정보를 분석하기 위해 특정 행위를 취할 때마다 서버로 로그를 전송하도록 변경했다.

### 1. 페이지 로그

사용자들이 어떤 경로를 통해 이동헀는지 분석하기 위해, 페이지 전환이 발생할 때마다 관련 로그를 전송하도록 변경했다. React Router의 `history.listen` 메서드를 활용하면 페이지 전환 시마다 특정 작업을 수행하도록 할 수 있다. 이 메서드를 Effect hook에서 사용하기 위해 `Routes` 컴포넌트를 분리 후 `withRouter`로 랩핑했다. 그런데 이렇게 분리하는 과정에서 `Routes` 컴포넌트의 역할과 책임을 생각했을 때, `BrowserRouter` 역시 `Routes` 컴포넌트 안에 함께 묶여있는게 맞지 않을까란 생각이 들었다. 그런데 그렇게 하게 되면 `withRouter`로 `Routes` 컴포넌트를 감쌀 수 없다는 문제가 생겨서 우선은 그대로 두었다. 더 좋은 방법을 고민해봐야겠다.

### 2. 이벤트 로그

가정통신문 배부를 위해 전송 버튼 클릭하기 등 의미있는 이벤트가 발생할 때마다 로그를 전송하도록 수정했다. 그런데 로그를 전송할 때 항상 사용자 정보도 함께 전송해야 하는데, 사용자 정보는 Redux store에 저장되어 있다. 이 값을 읽어오기 위해 이벤트 로그 적용이 필요한 모든 컴포넌트를 `connect`로 연결해야 할 지에 대한 고민이 들었다. 어떻게 처리하는게 좋을 지 고민이 좀 더 필요한 상황이다.

### 3. API 로그

API 요청이 발생할 때마다 로그를 전송하도록 변경했다. 이 부분은 `axios`의 `interceptors`를 통해 처리했다. `intercetors`는 발생된 요청을 중간에 가로채서 원하는 작업을 수행할 수 있도록 한다. 여기서도 역시 문제가 하나 있었다. 로그 전송 시 사용자 정보를 함께 보내야 하는데, `GET /me` 요청에 대한 응답을 받기 전까지는 사용자 정보를 알 수 없다는 것이엇다. 그렇기 때문에 서비스에 최초 접속 시 발생하는 요청에 대해서는 사용자 정보가 들어있지 않은 상황이다. 좀 더 고민이 필요하다.
